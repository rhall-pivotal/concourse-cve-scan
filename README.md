# Concourse-CVE-Scan

This repository is an example of a [Concourse](https://concourse-ci.org/) pipeline that utilizes a single `scan` task. This task allows a TAS Contributor to scan a configured Github repository for CVEs with Anchore tools [syft](https://github.com/anchore/syft) and [grype](https://github.com/anchore/grype). There is also an input that enables [TAS-CVE](https://github.com/pivotal/tas-cve) to upload your results to [Dependency-Track](https://dependencytrack-dev.apps.dhaka.cf-app.com/). 

Utilizing this example's [`scan`](https://github.com/rhall-pivotal/concourse-cve-scan/tree/main/tasks/scan) task enables TAS Contributors to check for CVEs earlier in their release processes, as it will scan a Github repository branch that can be configured in the pipeline's resources.

## Getting Help

This work is being done by [@ryanhall](https://vmware.slack.com/archives/DUWBJE4RL) as a member of [#TAS-Slingshots](https://vmware.slack.com/archives/C05J220TM34).

If you would like assistance in implementing the Scan task in your Concourse pipeline, please reach out to Ryan for help!

## Contents:

This example can be suited for your purposes with a small amount of customization. To get you familiar with how this works, here's what's involved in this scan:

* [ci/ci.yml](https://github.com/pivotal/concourse-cve-scan/blob/main/ci/ci.yml) - A pipeline definition utilizing 3 resources and 1 task that can be customized using 6 inputs:
  * [L29](https://github.com/pivotal/concourse-cve-scan/blob/main/ci/ci.yml#L29): `uri:` - Github URI of the Github Repo to be scanned.
  * [L30](https://github.com/pivotal/concourse-cve-scan/blob/main/ci/ci.yml#L30): `branch:` - Name of the Branch within the repo to be scanned.
  * [L43](https://github.com/pivotal/concourse-cve-scan/blob/main/ci/ci.yml#L43): `DRY_RUN:` - Disables the `tas-cve uploadBom` step when configured as `true`.  
  * [L44](https://github.com/pivotal/concourse-cve-scan/blob/main/ci/ci.yml#L44): `GRYPE_FAILURE_LEVEL:` - Sets the severity threshold for `grype` to fail on detected CVEs.
    * Must be configured as: [`none` | `negligible` | `low` | `medium` | `high` | `critical`]
  * [L45](https://github.com/pivotal/concourse-cve-scan/blob/main/ci/ci.yml#L45): `RELEASE_NAME` - Name of the project in [Dependency-Track](https://dependencytrack-dev.apps.dhaka.cf-app.com/) that your results will upload to.
  * [L46](https://github.com/pivotal/concourse-cve-scan/blob/main/ci/ci.yml#L46): `RELEASE_VERSION` -  Version of the project in [Dependency-Track](https://dependencytrack-dev.apps.dhaka.cf-app.com/) that your results will upload to.
 
* tasks/scan.yml - The task definition for the `scan` task. This is ready for consumption using the `params` & `inputs` from the CI.

* tasks/scan.sh - The script definition for the `scan` task. This is ready for consumption with the task definition.

* images/slingshot-scanner - The image definiton for the docker image used for the scan task. Pre-installs `syft`, `grype`, and some other basic Linux tooling.

## Contributing & Feedback

* **If you would like to contribute**, please do so utilizing a PR and a branch containing your changes. Request a review prior to merging. Tag @rhall-pivotal.
* **Feedback & Feature Requests**, please [file a new issue](https://github.com/rhall-pivotal/concourse-cve-scan/issues/new) and let me know what's on your mind!

## Resources:

* An example of this pipeline can be found on [Runway SFO](https://runway-ci-sfo.eng.vmware.com/teams/tas-slingshots/pipelines/cve-scan)
* Credentials being utilized in the example can be found in [Runway Vault SFO](https://runway-vault-sfo.eng.vmware.com/ui/vault/secrets/runway_concourse/show/tas-slingshots/cve_scan)
* This work is being done as a part of [Slingshot's CVE Plan](https://docs.google.com/document/d/1M6--ej0bMsydGKSbp46YkIfgneuG2ioFLB0MYW2yz9c/edit?usp=sharing).
