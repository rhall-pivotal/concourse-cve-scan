#!/usr/bin/env bash

set -euox pipefail

# dir='dir:'
# pwd="$(pwd)"
# grype_dir_path="$dir""$pwd"/$SCAN_REPO
# grype $grype_dir_path

cd $SCAN_REPO

syft packages \
    --output=cyclonedx-json \
    --file=../$SCAN_REPO.sbom
    dir:.

grype --add-cpes-if-none \
    --fail-on=high
    --sbom:../$SCAN_REPO.sbom

echo "Sleeping"

sleep 10m

exit 1